<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="utf-8">
  <meta name="viewport" content="width=device-width, initial-scale=1">
  <title>AdminLTE 3 | Fixed Sidebar</title>

  <!-- Google Font: Source Sans Pro -->
  <link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Source+Sans+Pro:300,400,400i,700&display=fallback">
  <!-- Font Awesome -->
  <link rel="stylesheet" href="../../static/plugins/fontawesome-free/css/all.min.css">
  <!-- overlayScrollbars -->
  <link rel="stylesheet" href="../../static/plugins/overlayScrollbars/css/OverlayScrollbars.min.css">
  <!-- Theme style -->
  <link rel="stylesheet" href="../../static/dist/css/adminlte.min.css">
</head>
<body class="hold-transition sidebar-mini layout-fixed">
<!-- Site wrapper -->
<div class="wrapper">
  <!-- Navbar -->
<!--  <nav class="main-header navbar navbar-expand navbar-white navbar-light">-->
<!--    &lt;!&ndash; Left navbar links &ndash;&gt;-->
<!--    <ul class="navbar-nav">-->
<!--      <li class="nav-item">-->
<!--        <a class="nav-link" data-widget="pushmenu" href="#" role="button"><i class="fas fa-bars"></i></a>-->
<!--      </li>-->
<!--      <li class="nav-item d-none d-sm-inline-block">-->
<!--        <a href="../../static/index3.html" class="nav-link">Home</a>-->
<!--      </li>-->
<!--      <li class="nav-item d-none d-sm-inline-block">-->
<!--        <a href="#" class="nav-link">Contact</a>-->
<!--      </li>-->
<!--    </ul>-->

<!--    &lt;!&ndash; Right navbar links &ndash;&gt;-->
<!--    <ul class="navbar-nav ml-auto">-->
<!--      &lt;!&ndash; Navbar Search &ndash;&gt;-->
<!--      <li class="nav-item">-->
<!--        <a class="nav-link" data-widget="navbar-search" href="#" role="button">-->
<!--          <i class="fas fa-search"></i>-->
<!--        </a>-->
<!--        <div class="navbar-search-block">-->
<!--          <form class="form-inline">-->
<!--            <div class="input-group input-group-sm">-->
<!--              <input class="form-control form-control-navbar" type="search" placeholder="Search" aria-label="Search">-->
<!--              <div class="input-group-append">-->
<!--                <button class="btn btn-navbar" type="submit">-->
<!--                  <i class="fas fa-search"></i>-->
<!--                </button>-->
<!--                <button class="btn btn-navbar" type="button" data-widget="navbar-search">-->
<!--                  <i class="fas fa-times"></i>-->
<!--                </button>-->
<!--              </div>-->
<!--            </div>-->
<!--          </form>-->
<!--        </div>-->
<!--      </li>-->

<!--      &lt;!&ndash; Messages Dropdown Menu &ndash;&gt;-->
<!--      <li class="nav-item dropdown">-->
<!--        <a class="nav-link" data-toggle="dropdown" href="#">-->
<!--          <i class="far fa-comments"></i>-->
<!--          <span class="badge badge-danger navbar-badge">3</span>-->
<!--        </a>-->
<!--        <div class="dropdown-menu dropdown-menu-lg dropdown-menu-right">-->
<!--          <a href="#" class="dropdown-item">-->
<!--            &lt;!&ndash; Message Start &ndash;&gt;-->
<!--            <div class="media">-->
<!--              <img src="../../static/dist/img/user1-128x128.jpg" alt="User Avatar" class="img-size-50 mr-3 img-circle">-->
<!--              <div class="media-body">-->
<!--                <h3 class="dropdown-item-title">-->
<!--                  Brad Diesel-->
<!--                  <span class="float-right text-sm text-danger"><i class="fas fa-star"></i></span>-->
<!--                </h3>-->
<!--                <p class="text-sm">Call me whenever you can...</p>-->
<!--                <p class="text-sm text-muted"><i class="far fa-clock mr-1"></i> 4 Hours Ago</p>-->
<!--              </div>-->
<!--            </div>-->
<!--            &lt;!&ndash; Message End &ndash;&gt;-->
<!--          </a>-->
<!--          <div class="dropdown-divider"></div>-->
<!--          <a href="#" class="dropdown-item">-->
<!--            &lt;!&ndash; Message Start &ndash;&gt;-->
<!--            <div class="media">-->
<!--              <img src="../../static/dist/img/user8-128x128.jpg" alt="User Avatar" class="img-size-50 img-circle mr-3">-->
<!--              <div class="media-body">-->
<!--                <h3 class="dropdown-item-title">-->
<!--                  John Pierce-->
<!--                  <span class="float-right text-sm text-muted"><i class="fas fa-star"></i></span>-->
<!--                </h3>-->
<!--                <p class="text-sm">I got your message bro</p>-->
<!--                <p class="text-sm text-muted"><i class="far fa-clock mr-1"></i> 4 Hours Ago</p>-->
<!--              </div>-->
<!--            </div>-->
<!--            &lt;!&ndash; Message End &ndash;&gt;-->
<!--          </a>-->
<!--          <div class="dropdown-divider"></div>-->
<!--          <a href="#" class="dropdown-item">-->
<!--            &lt;!&ndash; Message Start &ndash;&gt;-->
<!--            <div class="media">-->
<!--              <img src="../../static/dist/img/user3-128x128.jpg" alt="User Avatar" class="img-size-50 img-circle mr-3">-->
<!--              <div class="media-body">-->
<!--                <h3 class="dropdown-item-title">-->
<!--                  Nora Silvester-->
<!--                  <span class="float-right text-sm text-warning"><i class="fas fa-star"></i></span>-->
<!--                </h3>-->
<!--                <p class="text-sm">The subject goes here</p>-->
<!--                <p class="text-sm text-muted"><i class="far fa-clock mr-1"></i> 4 Hours Ago</p>-->
<!--              </div>-->
<!--            </div>-->
<!--            &lt;!&ndash; Message End &ndash;&gt;-->
<!--          </a>-->
<!--          <div class="dropdown-divider"></div>-->
<!--          <a href="#" class="dropdown-item dropdown-footer">See All Messages</a>-->
<!--        </div>-->
<!--      </li>-->
<!--      &lt;!&ndash; Notifications Dropdown Menu &ndash;&gt;-->
<!--      <li class="nav-item dropdown">-->
<!--        <a class="nav-link" data-toggle="dropdown" href="#">-->
<!--          <i class="far fa-bell"></i>-->
<!--          <span class="badge badge-warning navbar-badge">15</span>-->
<!--        </a>-->
<!--        <div class="dropdown-menu dropdown-menu-lg dropdown-menu-right">-->
<!--          <span class="dropdown-item dropdown-header">15 Notifications</span>-->
<!--          <div class="dropdown-divider"></div>-->
<!--          <a href="#" class="dropdown-item">-->
<!--            <i class="fas fa-envelope mr-2"></i> 4 new messages-->
<!--            <span class="float-right text-muted text-sm">3 mins</span>-->
<!--          </a>-->
<!--          <div class="dropdown-divider"></div>-->
<!--          <a href="#" class="dropdown-item">-->
<!--            <i class="fas fa-users mr-2"></i> 8 friend requests-->
<!--            <span class="float-right text-muted text-sm">12 hours</span>-->
<!--          </a>-->
<!--          <div class="dropdown-divider"></div>-->
<!--          <a href="#" class="dropdown-item">-->
<!--            <i class="fas fa-file mr-2"></i> 3 new reports-->
<!--            <span class="float-right text-muted text-sm">2 days</span>-->
<!--          </a>-->
<!--          <div class="dropdown-divider"></div>-->
<!--          <a href="#" class="dropdown-item dropdown-footer">See All Notifications</a>-->
<!--        </div>-->
<!--      </li>-->
<!--      <li class="nav-item">-->
<!--        <a class="nav-link" data-widget="fullscreen" href="#" role="button">-->
<!--          <i class="fas fa-expand-arrows-alt"></i>-->
<!--        </a>-->
<!--      </li>-->
<!--      <li class="nav-item">-->
<!--        <a class="nav-link" data-widget="control-sidebar" data-slide="true" href="#" role="button">-->
<!--          <i class="fas fa-th-large"></i>-->
<!--        </a>-->
<!--      </li>-->
<!--    </ul>-->
<!--  </nav>-->
<!--  &lt;!&ndash; /.navbar &ndash;&gt;-->

<!--  &lt;!&ndash; Main Sidebar Container &ndash;&gt;-->
<!--  <aside class="main-sidebar main-sidebar-custom sidebar-dark-primary elevation-4">-->
<!--    &lt;!&ndash; Brand Logo &ndash;&gt;-->
<!--    <a href="../../static/index3.html" class="brand-link">-->
<!--      <img src="../../static/dist/img/AdminLTELogo.png" alt="AdminLTE Logo" class="brand-image img-circle elevation-3" style="opacity: .8">-->
<!--      <span class="brand-text font-weight-light">AdminLTE 3</span>-->
<!--    </a>-->

<!--    &lt;!&ndash; Sidebar &ndash;&gt;-->
<!--    <div class="sidebar">-->
<!--      &lt;!&ndash; Sidebar user (optional) &ndash;&gt;-->
<!--      <div class="user-panel mt-3 pb-3 mb-3 d-flex">-->
<!--        <div class="image">-->
<!--          <img src="../../static/dist/img/user2-160x160.jpg" class="img-circle elevation-2" alt="User Image">-->
<!--        </div>-->
<!--        <div class="info">-->
<!--          <a href="#" class="d-block">Alexander Pierce</a>-->
<!--        </div>-->
<!--      </div>-->

<!--      &lt;!&ndash; SidebarSearch Form &ndash;&gt;-->
<!--      <div class="form-inline">-->
<!--        <div class="input-group" data-widget="sidebar-search">-->
<!--          <input class="form-control form-control-sidebar" type="search" placeholder="Search" aria-label="Search">-->
<!--          <div class="input-group-append">-->
<!--            <button class="btn btn-sidebar">-->
<!--              <i class="fas fa-search fa-fw"></i>-->
<!--            </button>-->
<!--          </div>-->
<!--        </div>-->
<!--      </div>-->


<!--      &lt;!&ndash; Sidebar Menu &ndash;&gt;-->
<!--      <nav class="mt-2">-->
<!--        <ul class="nav nav-pills nav-sidebar flex-column" data-widget="treeview" role="menu" data-accordion="false">-->
<!--          &lt;!&ndash; Add icons to the links using the .nav-icon class-->
<!--               with font-awesome or any other icon font library &ndash;&gt;-->
<!--          <li class="nav-item">-->
<!--            <a href="javascript:void(0);" onclick="loadFrameContent('/u/ForwardList');" class="nav-link">-->
<!--              <i class="nav-icon fas fa-tachometer-alt"></i>-->
<!--              <p>-->
<!--                端口转发列表-->
<!--                &lt;!&ndash; <i class="right fas fa-angle-left"></i> &ndash;&gt;-->
<!--              </p>-->
<!--            </a>-->
<!--			-->
<!--            &lt;!&ndash; <ul class="nav nav-treeview">-->
<!--              <li class="nav-item">-->
<!--                <a href="../../static/index.html" class="nav-link">-->
<!--                  <i class="far fa-circle nav-icon"></i>-->
<!--                  <p>端口转发列表</p>-->
<!--                </a>-->
<!--              </li>-->
<!--			  -->
<!--              <li class="nav-item">-->
<!--                <a href="../../static/index2.html" class="nav-link">-->
<!--                  <i class="far fa-circle nav-icon"></i>-->
<!--                  <p>快捷功能</p>-->
<!--                </a>-->
<!--              </li>-->
<!--			  -->
<!--              <li class="nav-item">-->
<!--                <a href="../../static/index3.html" class="nav-link">-->
<!--                  <i class="far fa-circle nav-icon"></i>-->
<!--                  <p>帮助说明</p>-->
<!--                </a>-->
<!--              </li>-->
<!--            </ul> &ndash;&gt;-->
<!--			-->
<!--          </li>-->

<!--          <li class="nav-item">-->
<!--            <a href="javascript:void(0);" onclick="loadFrameContent('/u/NetAgent');" class="nav-link">-->
<!--              <i class="nav-icon far fa-image"></i>-->
<!--              <p>-->
<!--                内网穿透服务-->
<!--              </p>-->
<!--            </a>-->
<!--          </li>-->
<!--		  -->
<!--		  <li class="nav-item">-->
<!--		    <a href="javascript:void(0);" onclick="loadFrameContent('/u/ApiDoc');" class="nav-link">-->
<!--		      <i class="nav-icon far fa-image"></i>-->
<!--		      <p>-->
<!--		        API接口-->
<!--		      </p>-->
<!--		    </a>-->
<!--		  </li>-->
<!--		  -->
<!--          -->
<!--        </ul>-->
<!--      </nav>-->
<!--	  -->
<!--	  -->
<!--      &lt;!&ndash; /.sidebar-menu &ndash;&gt;-->
<!--    </div>-->
<!--    &lt;!&ndash; /.sidebar &ndash;&gt;-->

<!--    <div class="sidebar-custom">-->
<!--      <a href="#" class="btn btn-link"><i class="fas fa-cogs"></i></a>-->
<!--      <a href="#" class="btn btn-secondary hide-on-collapse pos-right">Help</a>-->
<!--    </div>-->
<!--    &lt;!&ndash; /.sidebar-custom &ndash;&gt;-->
<!--  </aside>-->

  <!-- Content Wrapper. Contains page content -->
  <div class="content-wrapper">
    <!-- Content Header (Page header) -->
    <section class="content-header">
      <div class="container-fluid">
        <div class="row mb-2">
          <div class="col-sm-6">
            <h1>Fixed Layout</h1>
          </div>
          <div class="col-sm-6">
            <ol class="breadcrumb float-sm-right">
              <li class="breadcrumb-item"><a href="#">Home</a></li>
              <li class="breadcrumb-item"><a href="#">Layout</a></li>
              <li class="breadcrumb-item active">Fixed Layout</li>
            </ol>
          </div>
        </div>
      </div><!-- /.container-fluid -->
    </section>

    <!-- Main content -->
    <section class="content">
		
		
      <div class="container-fluid">
<!--        <div class="row">-->
          <div class="">
          <div class="col-12">
            <!-- Default box -->
			<div class="card card-success">
			  <div class="card-header">
			    <h3 class="card-title">Different Width</h3>
			  </div>
			  <div class="card-body">
			    <div >
					
			      <div class="col-3">
					<label for="exampleInputEmail1">本地端口</label>
			        <input type="text" id="port" name="port" class="form-control" placeholder="本地监听端口">
			      </div>
				  
			      <div class="col-4">
					<label for="exampleInputEmail1">目标地址</label>
			        <input type="text" id="targetAddr" name="targetAddr" class="form-control" placeholder="转发到地址">
			      </div>
				  
			      <div class="col-5">
					<label for="exampleInputEmail1">目标端口</label>
			        <input type="text" id="targetPort" name="targetPort" class="form-control" placeholder="转发到端口">
			      </div>
				  
			    </div>
				
			  </div>
			  <!-- /.card-body -->
			  <div class="card-footer">
			    <button type="submit" class="btn btn-success" onclick="query(1);" >查询</button>
			  </div>
			</div>
			
           <div class="card card-success">
             <div class="card-header">
               <h3 class="card-title">Different Width</h3>
             </div>
             
			 <div class="card-body">
			   <table class="table table-bordered table-hover">
			     <colgroup>
			       <col width="20">
			       <col width="50">
			       <col width="300">
			       <col width="150">
			       <col width="120">
			       <col width="150">
			       <col width="50">
			       <col width="150">
			       <col width="100">
			       <col width="70">
			       <col width="200">
			     </colgroup>
			     <thead>
			       <tr>
			         <th>
			           <input type="checkbox" name="" lay-skin="primary" lay-filter="allChoose">
			         </th>
			         <th>ID</th>
			         <th>名称</th>
			         <th>本地监听地址</th>
			         <th>本地监听端口</th>
			         <th>转发方式</th>
			         <th>协议</th>
			         <th>转发到地址</th>
			         <th>转发到端口</th>
			         <th>状态</th>
			         <th>操作</th>
			       </tr>
			     </thead>
			     <tbody id="gridBody">
			     </tbody>
			   </table>
			 </div>

			 
             <!-- /.card-body -->
             <div class="card-footer">
                 <div id="pagination"></div>
<!--               <button type="submit" class="btn btn-success" onclick="query(1);" >查询</button>-->
             </div>
           </div>
			
			
			
            <!-- /.card -->
          </div>
        </div>
      </div>
    </section>
    <!-- /.content -->
  </div>
  <!-- /.content-wrapper -->

  <footer class="main-footer">
    <div class="float-right d-none d-sm-block">
      <b>Version</b> 3.2.0
    </div>
    <strong>Copyright &copy; 2014-2021 <a href="https://adminlte.io">AdminLTE.io</a>.</strong> All rights reserved.
  </footer>

  <!-- Control Sidebar -->
  <aside class="control-sidebar control-sidebar-dark">
    <!-- Control sidebar content goes here -->
  </aside>
  <!-- /.control-sidebar -->
</div>
<!-- ./wrapper -->

<!-- jQuery -->
<script src="../../static/plugins/jquery/jquery.min.js"></script>
<!-- Bootstrap 4 -->
<script src="../../static/plugins/bootstrap/js/bootstrap.bundle.min.js"></script>
<!-- overlayScrollbars -->
<script src="../../static/plugins/overlayScrollbars/js/jquery.overlayScrollbars.min.js"></script>
<!-- AdminLTE App -->
<script src="../../static/dist/js/adminlte.min.js"></script>


<script id="grid_tpl" type="text/html">
  {Start{# if(d.Data === null || d.Data.length === 0){ }End}
  <tr>
    <td colspan="10">
      查询转发配置规则结果为空
    </td>
  </tr>
  {Start{# } else { }End} {Start{# layui.each(d.Data, function(index, item){ }End}
  <tr>
    <td>
      <input type="checkbox" name="id" lay-skin="primary" value="{Start{ item.Id }End}">
    </td>
    <td>{Start{ item.Id }End}</td>
    <td>{Start{ item.Name }End}</td>
    <td>{Start{ fmtAddr(item.Addr) }End}</td>
    <td>{Start{ item.Port }End}</td>
    <td>{Start{ fmtFType(item.FType) }End}</td>
    <td>{Start{ item.Protocol }End}</td>
    <td>{Start{ item.TargetAddr }End}</td>
    <td>{Start{ item.TargetPort }End}</td>
    <td>{Start{ fmtStatus(item.Status) }End}</td>
    <td>{Start{ oprFormatLink(item.Status,item) }End}</td>
  </tr>
  {Start{# }); }End} {Start{# } }End}
</script>
<script type="text/javascript">
$(document).ready(function() {
  layui.use(["jquery", "layer", "form", "element", "laytpl", "laypage"], function() {
    var $ = layui.jquery,
      layer = layui.layer,
      form = layui.form,
      laytpl = layui.laytpl,
      laypage = layui.laypage;

    var element = layui.element;

    //全选
    form.on('checkbox(allChoose)', function(data) {
      var child = $(data.elem).parents('table').find('tbody input[type="checkbox"]');
      child.each(function(index, item) {
        item.checked = data.elem.checked;
      });
      form.render('checkbox');
    });

    layui.laytpl.config({
      open: "{Start{",
      close: "}End}"
    });

    element.on('tab(tabForwardList)', function(data){
      console.log(data);
      form.render('checkbox');
      form.render();
    });

    form.on('checkbox()', function(data){
      console.log(data.elem); //得到checkbox原始DOM对象
      console.log(data.elem.checked); //是否被选中，true或者false
      console.log(data.value); //复选框value值，也可以通过data.elem.value得到
      console.log(data.othis); //得到美化后的DOM对象
    }); 

    form.on('switch(ForWardDebug)', function(data){
      $.get("/u/ChangeForwardDebug", {
        rnd: Math.random(),
        status: data.elem.checked?1:0
      }, function(json) {
        
      }, 'json');

    });

    //
    form.render('checkbox');
    form.render();
    //
    query(1);

  });
});

function query(pIndex) {
  // var columnFiled = $("#columnFiled").val();
  // var keyWord = $("#keyWord").val();
  var port = $("#port").val();
  var targetAddr = $("#targetAddr").val();
  var targetPort = $("#targetPort").val();

  $.post("ForwardList/json", {
    port: port,
    targetAddr: targetAddr,
    targetPort: targetPort,
    pIndex: pIndex,
    pSize: 10
  }, function(json) {
    if (json.Code == 0) { //成功
      renderGrid(json.Data);
      var totalPages = json.Data.Pages;
      var totalRows = json.Data.TotalRows;
      //显示分页
      layui.laypage.render({
        elem: 'pagination', //容器
        pages: totalPages, //通过后台拿到的总页数
        count: totalRows,
        limit: 10,
        limits: [10, 20, 30, 50, 100],
        groups: 5, //连续分页数
        skin: "#51b921", //控制分页皮肤。目前支持：molv、yahei、flow 除此之外，还支持16进制颜色值，如:skin:'#c00'
        curr: pIndex || 1, //当前页
        skip: true,
        layout: ['count','prev', 'page', 'next', 'skip'],
        jump: function(obj, first) { //触发分页后的回调
          if (!first) { //点击跳页触发函数自身，并传递当前页：obj.curr
            query(obj.curr);
          }
        }
      });
      layui.form.render('checkbox');
    } else { //失败
      layui.layer.alert("失败：" + json.Msg, {
        icon: 2
      });
    }
  }, 'json');
}

function renderGrid(data) {
  var grid_tpl = document.getElementById('grid_tpl').innerHTML;
  layui.laytpl(grid_tpl).render(data, function(html) {
    $("#gridBody").html(html);
  });
}

function oprFormatLink(val, row) {
  var html = "";
  if (row.Status == 1) {
    html += "<button class='layui-btn layui-btn-small layui-btn-danger' onclick='CloseForward(" + row.Id + ");'><i class='layui-icon'></i></button>";
  } else {
    html += "<button class='layui-btn layui-btn-small layui-btn-normal' onclick='OpenForward(" + row.Id + ");'><i class='layui-icon'></i></button>";
  }
  html += "<button class='layui-btn layui-btn-small' onclick='editForward(" + row.Id + ");'><i class='layui-icon'></i></button>";
  return html;
}

function fmtAddr(val) {
  if (val == "") {
    return "监听所有地址";
  } else {
    return val;
  }
}

function fmtFType(val) {
  var html = "";
  switch (val) {
    case 0:
      html = "<font color='blue'>端口到端口映射</font>";
      break;
    case 1:
      html = "<font color='orange'>内网映射 S->C</font>";
      break;
    case 2:
      html = "<font color='red'>内网反向映射 C->S</font>";
      break;
    default:
      html = "<font color='gray'>其它:" + val + "</font>";
      break;
  }
  return html;
}

function fmtStatus(val) {
  var html = "";
  switch (val) {
    case 0:
      html = "<font color='red'>停止</font>";
      break;
    case 1:
      html = "<font color='green'>转发中</font>";
      break;
    default:
      html = "<font color='gray'>其它:" + val + "</font>";
      break;
  }
  return html;
}

function addForward() {
  $.get('/u/AddForward', {
    rnd: Math.random()
  }, function(html) {
    layer.open({
      type: 1, //page层
      area: ['400px', '450px'],
      title: '添加网络转发端口',
      shade: 0.6, //遮罩透明度
      moveType: 1, //拖拽风格，0是默认，1是传统拖动
      shift: -1, //0-6的动画形式，-1不开启
      maxmin: false,
      content: html,
      btn: ['保存配置', '取消'],
      yes: function(index, layero) {
        submitForm(index);
      },
      btn2: function(index) {
        layer.close(index);
      },
      cancel: function(index) {
        layer.close(index);
      }
    });
  });
}

function editForward(id) {
  $.get('/u/EditForward', {
    rnd: Math.random(),
    id: id
  }, function(html) {
    layer.open({
      type: 1, //page层
      area: ['600px', '550px'],
      title: '编辑网络转发端口',
      shade: 0.6, //遮罩透明度
      moveType: 1, //拖拽风格，0是默认，1是传统拖动
      shift: -1, //0-6的动画形式，-1不开启
      maxmin: false,
      content: html,
      btn: ['保存配置', '取消'],
      yes: function(index, layero) {
        submitForm(index);
      },
      btn2: function(index) {
        layer.close(index);
      },
      cancel: function(index) {
        layer.close(index);
      }
    });
  });
}

function delForward() {
  var selectedItems = getChkValues("id");
  if (selectedItems.length == 0) {
    layer.alert("没有勾选要批量操作的数据.", {
      icon: 3,
      title: "警告信息"
    });
    return;
  }
  var ids = selectedItems.join(',');
  layer.confirm("确定批量删除勾选的数据吗？", {
    btn: ['确定', '取消'] //按钮
  }, function(index, layero) {
    $.post("/u/DelForward", {
      rnd: Math.random(),
      ids: ids
    }, function(json) {
      if (json.Code == 0) { //成功
        layer.msg("执行成功.");
        layer.close(index);
        query(1);
      } else { //失败
        layer.alert(json.Msg, {
          icon: 2
        });
        query(1);
      }
    }, 'json');
  });
}

function AddBatchForward() {
  $.get('/u/AddBatchForward', {
    rnd: Math.random()
  }, function(html) {
    layer.open({
      type: 1, //page层
      area: ['1200px', '700px'],
      title: '批量添加规则',
      shade: 0.6, //遮罩透明度
      moveType: 1, //拖拽风格，0是默认，1是传统拖动
      shift: -1, //0-6的动画形式，-1不开启
      maxmin: false,
      content: html,
      btn: ['保存', '取消'],
      yes: function(index, layero) {
        submitForm(index);
      },
      cancel: function(index) {
        layer.close(index);
      }
    });
  });
}

function ImportForward() {
  $.get('/u/ImportForward', {
    rnd: Math.random()
  }, function(html) {
    layer.open({
      type: 1, //page层
      area: ['750px', '500px'],
      title: '批量导入规则',
      shade: 0.6, //遮罩透明度
      moveType: 1, //拖拽风格，0是默认，1是传统拖动
      shift: -1, //0-6的动画形式，-1不开启
      maxmin: false,
      content: html,
      btn: ['保存', '取消'],
      yes: function(index, layero) {
        submitForm(index);
      },
      cancel: function(index) {
        layer.close(index);
      }
    });
  });
}

function refreshGrid() {
  query(1);
}

function OpenForward(id) {
  $.post("/u/OpenForward", {
      rnd: Math.random(),
      id: id
    }, function(json) {
      if (json.Code == 0) { //成功
        //layer.msg("执行成功.");
        //layer.close(index);
        query(1);
      } else { //失败
        layer.alert(json.Msg, {
          icon: 2
        });
        query(1);
      }
    }, 'json');
}

function CloseForward(id) {
  $.post("/u/CloseForward", {
      rnd: Math.random(),
      id: id
    }, function(json) {
      if (json.Code == 0) { //成功
        //layer.msg("执行成功.");
        //layer.close(index);
        query(1);
      } else { //失败
        layer.alert(json.Msg, {
          icon: 2
        });
        query(1);
      }
    }, 'json');
}

function OpenForward2(id) {
  layer.confirm("确定启动该转发吗？", {
    btn: ['确定', '取消'] //按钮
  }, function(index, layero) {
    $.post("/u/OpenForward", {
      rnd: Math.random(),
      id: id
    }, function(json) {
      if (json.Code == 0) { //成功
        layer.msg("执行成功.");
        layer.close(index);
        query(1);
      } else { //失败
        layer.alert(json.Msg, {
          icon: 2
        });
        query(1);
      }
    }, 'json');
  });
}

function CloseForward2(id) {
  layer.confirm("确定停止该转发吗？", {
    btn: ['确定', '取消'] //按钮
  }, function(index, layero) {
    $.post("/u/CloseForward", {
      rnd: Math.random(),
      id: id
    }, function(json) {
      if (json.Code == 0) { //成功
        layer.msg("执行成功.");
        layer.close(index);
        query(1);
      } else { //失败
        layer.alert(json.Msg, {
          icon: 2
        });
        query(1);
      }
    }, 'json');
  });
}

function OpenAllForward() {
  layer.confirm("确定一键开启所有转发吗？", {
    btn: ['确定', '取消'] //按钮
  }, function(index, layero) {
    $.post("/u/OpenAllForward", {
      rnd: Math.random()
    }, function(json) {
      if (json.Code == 0) { //成功
        layer.msg("执行成功.");
        layer.close(index);
        query(1);
      } else { //失败
        layer.alert(json.Msg, {
          icon: 2
        });
        query(1);
      }
    }, 'json');
  });
}

function CloseAllForward() {
  layer.confirm("确定一键关闭所有转发吗？", {
    btn: ['确定', '取消'] //按钮
  }, function(index, layero) {
    $.post("/u/CloseAllForward", {
      rnd: Math.random()
    }, function(json) {
      if (json.Code == 0) { //成功
        layer.msg("执行成功.");
        layer.close(index);
        query(1);
      } else { //失败
        layer.alert(json.Msg, {
          icon: 2
        });
        query(1);
      }
    }, 'json');
  });
}
</script>
</body>
</html>
